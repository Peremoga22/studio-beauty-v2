@page "/edit-seed"
@page "/edit-seed/{Id:int}"

@inject SeedService _seedService
@inject NavigationManager _navigationManager
@using System.ComponentModel.DataAnnotations
@using webStudioBlazor.EntityModels
@using webStudioBlazor.Services

<div class="container my-4">
    @if (Id == 0)
    {

        <nav aria-label="breadcrumb" class="bg-light rounded px-3 py-4 mb-4">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a href="/admin-seed" style="color: #f8b7d8;">Повернутися до наповнення</a></li>
                <li class="breadcrumb-item active" aria-current="page">Додати категорію</li>
            </ol>
        </nav>
    }
    else
    {
        <nav aria-label="breadcrumb" class="bg-light rounded px-3 py-4 mb-4">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a href="/admin-seed" style="color: #f8b7d8;">Повернутися до наповнення</a></li>
                <li class="breadcrumb-item active" aria-current="page">Редагувати категорію</li>
            </ol>
        </nav>
    }
    <div class="d-flex justify-content-center">
        <EditForm Model="@master" method="post" OnSubmit="HandleValidSubmit"
                  FormName="InputMaster" class="card shadow-sm border rounded-3 p-4 bg-white" style="width: 100%; max-width: 600px;">
            <DataAnnotationsValidator />
            <ValidationSummary class="alert alert-danger small" />
            <div class="card-body">
                <h5 class="card-title text-center mb-3 text-dark fw-bold">
                    @(Id == 0 ? "Додати майстра" : "Редагувати дані майстра")
                </h5>

                <div class="mb-3">
                    <label for="InputModel_Name" class="form-label fw-semibold small">
                        Додати майстра <span class="text-danger">*</span>
                    </label>
                    <InputText @bind-Value="InputMaster.MasterFullName" id="InputModel_FullName"
                               class="form-control form-control-sm"
                               placeholder="Введіть назву..." />
                    <ValidationMessage For="@(() => InputMaster.MasterFullName)" class="text-danger small" />
                </div>
                <div class="mb-3">
                    <label for="InputModel_Name" class="form-label fw-semibold small">
                        Додати мобільний майстра <span class="text-danger">*</span>
                    </label>
                    <InputText @bind-Value="InputMaster.MasterPhone" id="InputModel_Phone"
                               class="form-control form-control-sm"
                               placeholder="+380..." />
                    <ValidationMessage For="@(() => InputMaster.MasterPhone)" class="text-danger small" />
                </div>
               
                <div class="d-flex justify-content-end gap-2 mt-3">
                    <button type="submit" class="btn btn-sm btn-primary px-3">
                        <i class="bi bi-save"></i> Зберегти
                    </button>
                    <NavLink class="btn btn-sm btn-outline-secondary px-3" href="/admin-category">
                        <i class="bi bi-x-circle"></i> Скасувати
                    </NavLink>
                </div>
            </div>
        </EditForm>
    </div>
    <!-- Таблиця в картці -->
    <div class="card shadow-sm border-0 rounded-3">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="table-light text-uppercase small text-secondary">
                        <tr>
                            <th scope="col" class="px-4 py-3">Назва категорії</th>
                            <th scope="col" class="px-4 py-3 text-end">Дії</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (masters == null || masters.Count == 0)
                        {
                            <tr>
                                <td colspan="2" class="text-center text-muted py-4">
                                    Немає жодної категорії. Натисніть
                                    <span class="fw-semibold text-success">«Додати категорію»</span>.
                                </td>
                            </tr>
                        }
                        else
                        {
                            @foreach (var item in masters)
                            {
                                <tr>
                                    <td class="px-4 py-3">
                                        <div class="d-flex flex-column">
                                            <span class="fw-bold">@item.FullName</span>
                                            <small class="text-muted">@item.Phone</small>
                                        </div>
                                    </td>

                                    <td class="px-4 py-3 text-end">
                                        <div class="d-flex flex-wrap justify-content-end gap-2">

                                            <NavLink class="btn btn-sm btn-outline-primary"
                                                     href="@($"/edit-category/{item.Id}")">
                                                <i class="bi bi-pencil-square"></i>
                                                <span class="d-none d-sm-inline ms-1">Редагувати</span>
                                            </NavLink>

                                            <button type="button"
                                                    class="btn btn-sm btn-outline-danger"
                                                    @onclick="() => Delete(item.Id)">
                                                <i class="bi bi-trash"></i>
                                                <span class="d-none d-sm-inline ms-1">Видалити</span>
                                            </button>

                                        </div>
                                    </td>

                                </tr>

                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="d-flex justify-content-center">
        <EditForm Model="@master" method="post" OnSubmit="HandleValidSubmit"
                  FormName="InputMaster" class="card shadow-sm border rounded-3 p-4 bg-white" style="width: 100%; max-width: 600px;">
            <DataAnnotationsValidator />
            <ValidationSummary class="alert alert-danger small" />
            <div class="card-body">
                <h5 class="card-title text-center mb-3 text-dark fw-bold">
                    @(Id == 0 ? " Додати категорію" : "Редагувати категорію")
                </h5>

                <div class="mb-3">
                    <label for="InputModel_NameCategory" class="form-label fw-semibold small">
                        Додати категорію <span class="text-danger">*</span>
                    </label>
                    <InputText @bind-Value="InputMaster.NameCategory" id="InputModel_NameCategory"
                               class="form-control form-control-sm"
                               placeholder="Введіть назву..." />
                    <ValidationMessage For="@(() => InputMaster.NameCategory)" class="text-danger small" />
                </div>               

                <div class="d-flex justify-content-end gap-2 mt-3">
                    <button type="submit" class="btn btn-sm btn-primary px-3">
                        <i class="bi bi-save"></i> Зберегти
                    </button>
                    <NavLink class="btn btn-sm btn-outline-secondary px-3" href="/admin-category">
                        <i class="bi bi-x-circle"></i> Скасувати
                    </NavLink>
                </div>
            </div>
        </EditForm>
    </div>
    <!-- Таблиця в картці -->
    <div class="card shadow-sm border-0 rounded-3">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="table-light text-uppercase small text-secondary">
                        <tr>
                            <th scope="col" class="px-4 py-3">Назва категорії</th>
                            <th scope="col" class="px-4 py-3 text-end">Дії</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (categories == null || categories.Count == 0)
                        {
                            <tr>
                                <td colspan="2" class="text-center text-muted py-4">
                                    Немає жодної категорії. Натисніть
                                    <span class="fw-semibold text-success">«Додати категорію»</span>.
                                </td>
                            </tr>
                        }
                        else
                        {
                            @foreach (var item in categories)
                            {
                                <tr>
                                    <td class="px-4 py-3">
                                        <div class="d-flex flex-column">
                                            <span class="fw-bold">@item.NameCategory</span>                                           
                                        </div>
                                    </td>

                                    <td class="px-4 py-3 text-end">
                                        <div class="d-flex flex-wrap justify-content-end gap-2">

                                            <NavLink class="btn btn-sm btn-outline-primary"
                                                     href="@($"/edit-category/{item.Id}")">
                                                <i class="bi bi-pencil-square"></i>
                                                <span class="d-none d-sm-inline ms-1">Редагувати</span>
                                            </NavLink>

                                            <button type="button"
                                                    class="btn btn-sm btn-outline-danger"
                                                    @onclick="() => Delete(item.Id)">
                                                <i class="bi bi-trash"></i>
                                                <span class="d-none d-sm-inline ms-1">Видалити</span>
                                            </button>

                                        </div>
                                    </td>

                                </tr>

                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="d-flex justify-content-center">
        <EditForm Model="@master" method="post" OnSubmit="HandleValidSubmit"
                  FormName="InputMaster" class="card shadow-sm border rounded-3 p-4 bg-white" style="width: 100%; max-width: 600px;">
            <DataAnnotationsValidator />
            <ValidationSummary class="alert alert-danger small" />
            <div class="card-body">
                <h5 class="card-title text-center mb-3 text-dark fw-bold">
                    @(Id == 0 ? "Додати титолку сторінку терапії" : "Редагувати  титолку сторінку терапії")
                </h5>
                              
                <div class="mb-3">
                    <label for="InputModel_NameCategory" class="form-label fw-semibold small">
                        Додати титолку сторінку терапії <span class="text-danger">*</span>
                    </label>
                    <InputText @bind-Value="InputMaster.TitlePage" id="InputModel_TitlePage"
                               class="form-control form-control-sm"
                               placeholder="Введіть назву..." />
                    <ValidationMessage For="@(() => InputMaster.TitlePage)" class="text-danger small" />
                </div>
                <div class="mb-3">
                    <label for="InputModel_NameCategory" class="form-label fw-semibold small">
                        Додати опис сторінки терапії <span class="text-danger">*</span>
                    </label>
                    <InputText @bind-Value="InputMaster.DescriptionPage" id="InputModel_DescriptionPage"
                               class="form-control form-control-sm"
                               placeholder="Введіть назву..." />
                    <ValidationMessage For="@(() => InputMaster.DescriptionPage)" class="text-danger small" />
                </div>

                <div class="d-flex justify-content-end gap-2 mt-3">
                    <button type="submit" class="btn btn-sm btn-primary px-3">
                        <i class="bi bi-save"></i> Зберегти
                    </button>
                    <NavLink class="btn btn-sm btn-outline-secondary px-3" href="/admin-category">
                        <i class="bi bi-x-circle"></i> Скасувати
                    </NavLink>
                </div>
            </div>
        </EditForm>
    </div>
    <!-- Таблиця в картці -->
    <div class="card shadow-sm border-0 rounded-3">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="table-light text-uppercase small text-secondary">
                        <tr>
                            <th scope="col" class="px-4 py-3">Назва категорії</th>
                            <th scope="col" class="px-4 py-3 text-end">Дії</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (pageTherapies == null || pageTherapies.Count == 0)
                        {
                            <tr>
                                <td colspan="2" class="text-center text-muted py-4">
                                    Немає жодної категорії. Натисніть
                                    <span class="fw-semibold text-success">«Додати категорію»</span>.
                                </td>
                            </tr>
                        }
                        else
                        {
                            @foreach (var item in pageTherapies)
                            {
                                <tr>
                                    <td class="px-4 py-3">
                                        <div class="d-flex flex-column">
                                            <span class="fw-bold">@item.TitlePage</span>
                                        </div>
                                    </td>
                                    <td class="px-4 py-3">
                                        <div class="d-flex flex-column">
                                            <span class="fw-bold">@item.DescriptionPage</span>
                                        </div>
                                    </td>

                                    <td class="px-4 py-3 text-end">
                                        <div class="d-flex flex-wrap justify-content-end gap-2">

                                            <NavLink class="btn btn-sm btn-outline-primary"
                                                     href="@($"/edit-category/{item.Id}")">
                                                <i class="bi bi-pencil-square"></i>
                                                <span class="d-none d-sm-inline ms-1">Редагувати</span>
                                            </NavLink>

                                            <button type="button"
                                                    class="btn btn-sm btn-outline-danger"
                                                    @onclick="() => Delete(item.Id)">
                                                <i class="bi bi-trash"></i>
                                                <span class="d-none d-sm-inline ms-1">Видалити</span>
                                            </button>

                                        </div>
                                    </td>

                                </tr>

                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>




@code {
    [Parameter]
    public int Id { get; set; }
    private Master master = new();
    private Category category = new();
    private PageTherapy pageTherapy = new();
    private List<Master> masters = new();
    private List<Category> categories = new();
    private List<PageTherapy> pageTherapies = new();

    [SupplyParameterFromForm]
    private InputModel InputMaster { get; set; } = new();

    protected override async Task OnInitializedAsync()
    {
        masters = await _seedService.GetAllMasterListAsync();
        categories = await _seedService.GetAllCategoryListAsync();
        pageTherapies = await _seedService.GetAllPageTherapyListAsync();
    }

    private async Task HandleValidSubmit()
    {
        master.FullName = InputMaster.MasterFullName;
        master.Phone = InputMaster.MasterPhone;
        category.NameCategory = InputMaster.NameCategory;
        pageTherapy.TitlePage = InputMaster.TitlePage;
        pageTherapy.DescriptionPage = InputMaster.DescriptionPage;

        await _seedService.AddSeedAsync(master, category, pageTherapy);
        _navigationManager.NavigateTo("/admin-seed");
    }

    public async Task Delete(int id)
    {

        StateHasChanged();
    }

    private sealed class InputModel
    {
        [Required]
        public string MasterFullName { get; set; } = "";
        [Required]
        public string MasterPhone { get; set; } = "";
        [Required]
        public string NameCategory { get; set; } = "";
        [Required]
        public string TitlePage { get; set; } = "";
        [Required]
        public string DescriptionPage { get; set; } = "";
    }

}
